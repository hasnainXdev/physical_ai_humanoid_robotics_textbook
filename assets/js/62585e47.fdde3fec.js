"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[2981],{2352:(e,n,s)=>{s.d(n,{A:()=>g});var i=s(6540),r=s(7489),t=s(2181),l=s(6342),c=s(5293);let o=null;async function d(){return o||(o=async function(){return(await s.e(2279).then(s.bind(s,2279))).default}()),o}const a="docusaurus-mermaid-container";function h(){const{colorMode:e}=(0,c.G)(),n=(0,l.p)().mermaid,s=n.theme[e],{options:r}=n;return(0,i.useMemo)(()=>({startOnLoad:!1,...r,theme:s}),[s,r])}function u({text:e,config:n}){const[s,r]=(0,i.useState)(null),t=(0,i.useState)(`mermaid-svg-${Math.round(1e7*Math.random())}`)[0],l=h(),c=n??l;return(0,i.useEffect)(()=>{(async function({id:e,text:n,config:s}){const i=await d();i.initialize(s);try{return await i.render(e,n)}catch(r){throw document.querySelector(`#d${e}`)?.remove(),r}})({id:t,text:e,config:c}).then(r).catch(e=>{r(()=>{throw e})})},[t,e,c]),s}const p={container:"container_lyt7"};var m=s(4848);function x({renderResult:e}){const n=(0,i.useRef)(null);return(0,i.useEffect)(()=>{const s=n.current;e.bindFunctions?.(s)},[e]),(0,m.jsx)("div",{ref:n,className:`${a} ${p.container}`,dangerouslySetInnerHTML:{__html:e.svg}})}function j({value:e}){const n=u({text:e});return null===n?null:(0,m.jsx)(x,{renderResult:n})}function g(e){return(0,m.jsx)(r.A,{fallback:e=>(0,m.jsx)(t.MN,{...e}),children:(0,m.jsx)(j,{...e})})}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}},9684:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module1-ros2/pub-sub-rclpy","title":"Pub/Sub with rclpy","description":"Now that we understand the core concepts, it\'s time to write our first ROS 2 nodes. We\'ll use rclpy, the official Python client library for ROS 2, to create a simple publisher and subscriber. This is the \\"Hello World\\" of ROS.","source":"@site/docs/module1-ros2/03-pub-sub-rclpy.mdx","sourceDirName":"module1-ros2","slug":"/module1-ros2/pub-sub-rclpy","permalink":"/physical_ai_humanoid_robotics_textbook/docs/module1-ros2/pub-sub-rclpy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module1-ros2/03-pub-sub-rclpy.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Pub/Sub with rclpy","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Concepts","permalink":"/physical_ai_humanoid_robotics_textbook/docs/module1-ros2/concepts"},"next":{"title":"Launch Files","permalink":"/physical_ai_humanoid_robotics_textbook/docs/module1-ros2/04-launch-files"}}');var r=s(4848),t=s(8453),l=s(2352);const c={title:"Pub/Sub with rclpy",sidebar_position:3},o="1.3 Hands-On: Publisher/Subscriber Communication with rclpy",d={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"The Goal",id:"the-goal",level:2},{value:"Step 1: Create a ROS 2 Package",id:"step-1-create-a-ros-2-package",level:2},{value:"Step 2: Write the Publisher Node (<code>talker.py</code>)",id:"step-2-write-the-publisher-node-talkerpy",level:2},{value:"Code Breakdown:",id:"code-breakdown",level:3},{value:"Step 3: Write the Subscriber Node (<code>listener.py</code>)",id:"step-3-write-the-subscriber-node-listenerpy",level:2},{value:"Code Breakdown:",id:"code-breakdown-1",level:3},{value:"Step 4: Add Entry Points to <code>setup.py</code>",id:"step-4-add-entry-points-to-setuppy",level:2},{value:"Step 5: Build and Run",id:"step-5-build-and-run",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsxs)(n.h1,{id:"13-hands-on-publishersubscriber-communication-with-rclpy",children:["1.3 Hands-On: Publisher/Subscriber Communication with ",(0,r.jsx)(n.code,{children:"rclpy"})]})}),"\n",(0,r.jsxs)(n.p,{children:["Now that we understand the core concepts, it's time to write our first ROS 2 nodes. We'll use ",(0,r.jsx)(n.code,{children:"rclpy"}),', the official Python client library for ROS 2, to create a simple publisher and subscriber. This is the "Hello World" of ROS.']}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A working ROS 2 installation (e.g., Humble Hawksbill)."}),"\n",(0,r.jsx)(n.li,{children:"A text editor (e.g., VS Code)."}),"\n",(0,r.jsxs)(n.li,{children:["Your ROS 2 environment sourced. Remember to run ",(0,r.jsx)(n.code,{children:"source /opt/ros/humble/setup.bash"})," in every new terminal."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"the-goal",children:"The Goal"}),"\n",(0,r.jsx)(n.p,{children:"We will create two nodes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"Publisher Node"})," (",(0,r.jsx)(n.code,{children:"talker"}),") that continuously broadcasts a string message with a counter."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"Subscriber Node"})," (",(0,r.jsx)(n.code,{children:"listener"}),") that listens for these messages and prints them to the console."]}),"\n"]}),"\n",(0,r.jsx)(l.A,{chart:'\ngraph TD\n  A[Node: talker] -- Publishes --\x3e B((Topic: /chatter));\n  B -- Message: "Hello World: 1" --\x3e C[Node: listener];\n  B -- Message: "Hello World: 2" --\x3e C;\n  B -- "..." --\x3e C;\n  style B fill:#87CEEB\n'}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"step-1-create-a-ros-2-package",children:"Step 1: Create a ROS 2 Package"}),"\n",(0,r.jsxs)(n.p,{children:["First, we need a package to house our code. A package is a directory with a specific structure and a ",(0,r.jsx)(n.code,{children:"package.xml"})," file that contains metadata about the package."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Navigate to the src directory of your ROS 2 workspace\ncd ~/ros2_ws/src\n\n# Create a new package named 'my_py_pkg' with a dependency on 'rclpy'\nros2 pkg create --build-type ament_python my_py_pkg --dependencies rclpy\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This command creates a ",(0,r.jsx)(n.code,{children:"my_py_pkg"})," directory with the following structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"my_py_pkg/\n\u251c\u2500\u2500 my_py_pkg/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 resource/\n\u2502   \u2514\u2500\u2500 my_py_pkg\n\u251c\u2500\u2500 test/\n\u2502   \u251c\u2500\u2500 test_copyright.py\n\u2502   \u2514\u2500\u2500 test_flake8.py\n\u2502   \u2514\u2500\u2500 test_pep257.py\n\u251c\u2500\u2500 package.xml\n\u2514\u2500\u2500 setup.py\n\u2514\u2500\u2500 setup.cfg\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"step-2-write-the-publisher-node-talkerpy",children:["Step 2: Write the Publisher Node (",(0,r.jsx)(n.code,{children:"talker.py"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Inside the ",(0,r.jsx)(n.code,{children:"my_py_pkg/my_py_pkg/"})," directory, create a new file named ",(0,r.jsx)(n.code,{children:"talker.py"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# my_py_pkg/my_py_pkg/talker.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MinimalPublisher(Node):\n\n    def __init__(self):\n        super().__init__('minimal_publisher')\n        self.publisher_ = self.create_publisher(String, 'chatter', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = 'Hello World: %d' % self.i\n        self.publisher_.publish(msg)\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_publisher = MinimalPublisher()\n    rclpy.spin(minimal_publisher)\n    minimal_publisher.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown",children:"Code Breakdown:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"import"})}),": We import ",(0,r.jsx)(n.code,{children:"rclpy"}),", ",(0,r.jsx)(n.code,{children:"Node"}),", and the ",(0,r.jsx)(n.code,{children:"String"})," message type from ",(0,r.jsx)(n.code,{children:"std_msgs.msg"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"MinimalPublisher"})," Class"]}),": We create a class that inherits from ",(0,r.jsx)(n.code,{children:"Node"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"__init__"})}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"super().__init__('minimal_publisher')"}),": We initialize the parent ",(0,r.jsx)(n.code,{children:"Node"})," class with the name of our node."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_publisher(String, 'chatter', 10)"}),": This is the core of the publisher. We tell the node we want to publish messages of type ",(0,r.jsx)(n.code,{children:"String"})," on the topic named ",(0,r.jsx)(n.code,{children:"chatter"}),". The ",(0,r.jsx)(n.code,{children:"10"})," is the queue size\u2014a quality of service (QoS) setting that limits the amount of queued messages if a subscriber is not receiving them fast enough."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_timer(...)"}),": We create a timer that will call ",(0,r.jsx)(n.code,{children:"timer_callback"})," every ",(0,r.jsx)(n.code,{children:"0.5"})," seconds."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"timer_callback"})}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This function is executed every time the timer fires."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"msg = String()"}),": We create an instance of the ",(0,r.jsx)(n.code,{children:"String"})," message."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"msg.data = ..."}),": We populate the message's ",(0,r.jsx)(n.code,{children:"data"})," field."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.publisher_.publish(msg)"}),": We publish the message to the ",(0,r.jsx)(n.code,{children:"chatter"})," topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.get_logger().info(...)"}),": We print a log message to the console."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"main"})," function"]}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rclpy.init()"}),": Initializes the ",(0,r.jsx)(n.code,{children:"rclpy"})," library."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"minimal_publisher = MinimalPublisher()"}),": Creates an instance of our node."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rclpy.spin(minimal_publisher)"}),": This is the main event loop. It keeps the node running and allows it to process callbacks (like our timer callback). The program will stay in this function until you press ",(0,r.jsx)(n.code,{children:"Ctrl+C"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"destroy_node()"})," and ",(0,r.jsx)(n.code,{children:"shutdown()"}),": Clean up resources when the program exits."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"step-3-write-the-subscriber-node-listenerpy",children:["Step 3: Write the Subscriber Node (",(0,r.jsx)(n.code,{children:"listener.py"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Now, create a file named ",(0,r.jsx)(n.code,{children:"listener.py"})," in the same directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# my_py_pkg/my_py_pkg/listener.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MinimalSubscriber(Node):\n\n    def __init__(self):\n        super().__init__('minimal_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'chatter',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_subscriber = MinimalSubscriber()\n    rclpy.spin(minimal_subscriber)\n    minimal_subscriber.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown-1",children:"Code Breakdown:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"__init__"})}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_subscription(String, 'chatter', self.listener_callback, 10)"}),": This is the core of the subscriber. We subscribe to the ",(0,r.jsx)(n.code,{children:"chatter"})," topic, expecting messages of type ",(0,r.jsx)(n.code,{children:"String"}),". Every time a message is received, the function ",(0,r.jsx)(n.code,{children:"self.listener_callback"})," will be executed. The queue size of ",(0,r.jsx)(n.code,{children:"10"})," is a QoS setting."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"listener_callback"})}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This function is the entry point for incoming messages."}),"\n",(0,r.jsxs)(n.li,{children:["It receives one argument: ",(0,r.jsx)(n.code,{children:"msg"}),", which is the ",(0,r.jsx)(n.code,{children:"String"})," message instance received from the topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.get_logger().info(...)"}),": We simply log the content of the message's ",(0,r.jsx)(n.code,{children:"data"})," field to the console."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"step-4-add-entry-points-to-setuppy",children:["Step 4: Add Entry Points to ",(0,r.jsx)(n.code,{children:"setup.py"})]}),"\n",(0,r.jsxs)(n.p,{children:["To make our nodes executable with ",(0,r.jsx)(n.code,{children:"ros2 run"}),", we need to tell ROS 2 about them in the ",(0,r.jsx)(n.code,{children:"setup.py"})," file."]}),"\n",(0,r.jsxs)(n.p,{children:["Open ",(0,r.jsx)(n.code,{children:"my_py_pkg/setup.py"})," and add the ",(0,r.jsx)(n.code,{children:"entry_points"})," argument to the ",(0,r.jsx)(n.code,{children:"setup"})," function:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# ... inside setup.py\nsetup(\n    # ... other arguments\n    entry_points={\n        'console_scripts': [\n            'talker = my_py_pkg.talker:main',\n            'listener = my_py_pkg.listener:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This tells ",(0,r.jsx)(n.code,{children:"ros2"})," that the executable ",(0,r.jsx)(n.code,{children:"talker"})," is created by running the ",(0,r.jsx)(n.code,{children:"main"})," function from ",(0,r.jsx)(n.code,{children:"my_py_pkg.talker"}),", and similarly for ",(0,r.jsx)(n.code,{children:"listener"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"step-5-build-and-run",children:"Step 5: Build and Run"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build the package"}),":\nNavigate to the root of your workspace (",(0,r.jsx)(n.code,{children:"~/ros2_ws"}),") and run:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"colcon build --packages-select my_py_pkg\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source the workspace"}),":\nIn each new terminal you open, you must source your workspace's setup file to make your new executables available."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run the nodes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In one terminal, run the talker:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 run my_py_pkg talker\n# Output:\n# [INFO] [minimal_publisher]: Publishing: "Hello World: 0"\n# [INFO] [minimal_publisher]: Publishing: "Hello World: 1"\n# ...\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["In a second terminal (remember to source!), run the listener:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 run my_py_pkg listener\n# Output:\n# [INFO] [minimal_subscriber]: I heard: "Hello World: 0"\n# [INFO] [minimal_subscriber]: I heard: "Hello World: 1"\n# ...\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["You have successfully created a publisher and a subscriber! They are communicating anonymously over the ",(0,r.jsx)(n.code,{children:"/chatter"})," topic. You can use ROS 2 command-line tools like ",(0,r.jsx)(n.code,{children:"ros2 topic list"})," and ",(0,r.jsx)(n.code,{children:"ros2 node list"})," to inspect what's happening under the hood. We'll cover those tools in a later section."]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);